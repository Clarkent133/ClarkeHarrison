

sudo apt update && sudo apt full-upgrade -y && sudo apt autoremove -y && sudo apt clean









Mount external Drive

sudo mkdir -p /mnt/storage
lsblk
sudo mount -t ext4 /dev/sdb1 /mnt/storage
sudo chown -R $USER:$USER /mnt/storage

blkid
IN /etc/fstab ADD : 
UUID=xxxx-xxxx  /mnt/storage  ext4  defaults  0  2









Install Node and NPM

sudo apt install -y nodejs npm
node -v
npm -v













Install DYNU DNS (Login via GUI)

sudo apt update
sudo apt install dotnet-runtime-8.0
wget -O dynu.deb https://www.dynu.com/support/downloadfile/69
sudo apt install ./dynu.deb









Setup Docker

sudo apt install -y ca-certificates curl gnupg lsb-release
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
  sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER








Check Docker has installed

docker --version
docker compose version






Install NextCloud, OnlyOffice and Caddy

sudo mkdir -p /mnt/storage/nextcloud/{app,db,onlyoffice,caddy}
sudo chown -R $USER:$USER /mnt/storage/nextcloud
sudo apt remove -y docker.io containerd containerd.io
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo systemctl enable --now docker
sudo mkdir -p /mnt/storage/nextcloud/caddy_config
mkdir -p ~/nextcloud-docker
cd ~/nextcloud-docker


In docker-compose.yml
------------------------------------------------------------------------------------------------------
version: "3.8"

services:
  db:
    image: mariadb:11
    container_name: nextcloud_db
    restart: unless-stopped
    volumes:
      - /mnt/storage/nextcloud/db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=5xCJ2hvxd3LWNd36
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=5xrjZIWw2InQ8TQG
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW

  nextcloud:
    image: nextcloud:latest
    container_name: nextcloud_app
    restart: unless-stopped
    volumes:
      - /mnt/storage/nextcloud/app:/var/www/html
      - /mnt/storage/nextcloud/data:/var/www/html/data
    environment:
      - MYSQL_HOST=db
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=5xrjZIWw2InQ8TQG
    depends_on:
      - db
    labels:
      caddy: "harrisonhousehold.ddnsfree.com"
      caddy.reverse_proxy: "{{upstreams 80}}"

  onlyoffice:
    image: onlyoffice/documentserver:latest
    container_name: onlyoffice
    restart: unless-stopped
    volumes:
      - /mnt/storage/nextcloud/onlyoffice:/var/www/onlyoffice/Data
    labels:
      caddy: "office.harrisonhousehold.ddnsfree.com"
      caddy.reverse_proxy: "{{upstreams 80}}"

  caddy:
    image: lucaslorentz/caddy-docker-proxy:2.8
    container_name: caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /mnt/storage/nextcloud/caddy:/data
      - /mnt/storage/nextcloud/caddy_config:/config
      - /var/run/docker.sock:/var/run/docker.sock:ro
    command: caddy docker-proxy
------------------------------------------------------------------------------------------------------

sudo docker compose up -d

Then in NextCloud settings for ONLYOFFICE set the Document Editing Service address to:
https://office.harrisonhousehold.ddnsfree.com











CaddyFile 
-----------------------------------------------------------------
harrisonhousehold.ddnsfree.com {
    reverse_proxy localhost:8080
}

clarkeharrison.ddnsfree.com {
    reverse_proxy localhost:3000
}

# ONLYOFFICE (if you want)
onlyoffice.example.com {
    reverse_proxy localhost:8081
}
-----------------------------------------------------------------











Check NextCloud, OnlyOffice and Caddy are setup

docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

You should see:
- nextcloud_app → Up with no errors
- nextcloud_db → Up
- onlyoffice → Up
- caddy → Up with ports 80/tcp and 443/tcp

